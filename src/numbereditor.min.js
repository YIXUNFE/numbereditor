(function(f){function k(a,c){var b=a[0],e=b.tagName.toLowerCase();"input"===e||"textarea"===e?b.value=c:a.text(c)}function p(){q.apply(this);this.check();r.apply(this)}function q(){var a=this.cfg,c=this.jIpt,b=f('<div id="J_numberEditor" class="number-control"><a class="number-subtract number-control-btn" href="javascript:">-</a><a class="number-plus number-control-btn" href="javascript:">+</a></div>'),e=b.find(".number-subtract"),d=b.find(".number-plus");c.before(b);d.before(c);a.readonly?c.attr("readonly",
"readonly"):c.removeAttr("readonly");a.remote&&(this.jLoading=f('<span class="number-loading">loading...</span>'),d.after(this.jLoading));this.wrapper=b;this.jSubtractBtn=e;this.jPlusBtn=d;a.afterRender&&a.afterRender.apply(this)}function r(){var a=this;this.jSubtractBtn.on(l.click,function(){f(this).hasClass("disable")||a.getPostStatus()||m.call(a,-a.cfg.step)});this.jPlusBtn.on(l.click,function(){f(this).hasClass("disable")||a.getPostStatus()||m.call(a,a.cfg.step)});this.jIpt.on("focus",function(c){if(a.getPostStatus())return c.preventDefault(),
!1});this.jIpt.on("blur",function(){a.getPostStatus()||a.check(parseInt(this.value,10))})}function m(a){this.check(this.value+a)}function t(){var a=this,c=this.cfg,b=c.remote.apply(this);this.getPostStatus()||(this.setPostStatus(!0),f.ajax(b).then(function(b){c.onChange.call(a,b);a.setPostStatus(!1)},function(b){c.onChange.call(a,{errno:-1E4,msg:"request fail"});a.setPostStatus(!1)}))}function g(a,c){var b=0;this.jIpt=f(a);this.cfg=f.extend({},u,c);var b=parseInt,e=this.jIpt,d="",d=e[0],n=d.tagName.toLowerCase(),
d="input"===n||"textarea"===n?d.value:e.text(),b=b(d,10);this.value="NaN"===b.toString()?"undefined"!==typeof this.cfg.min?this.cfg.min:0:b;p.apply(this)}var h="ontouchend"in document,l={click:"click",start:h?"touchstart":"mousedown",move:h?"touchmove":"mousemove",end:h?"touchend":"mouseup",cancel:h?"touchcancel":"mousecancel"},u={step:1,readonly:!0,remote:null,beforeChange:function(){},onChange:function(){},afterRender:function(){}};g.prototype={constructor:g,check:function(a){var c=this.jIpt,b=
this.cfg,e=this.value,d=b.min,f=b.max;a="undefined"!==typeof a?a:e;"NaN"===a.toString()?k(c,e):("undefined"!==typeof d&&(a<=d?(a=d,this.jSubtractBtn.addClass("disable")):this.jSubtractBtn.removeClass("disable")),"undefined"!==typeof f&&(a>=f?(a=f,this.jPlusBtn.addClass("disable")):this.jPlusBtn.removeClass("disable")),a===e?k(c,e):b.beforeChange&&!1===b.beforeChange.apply(this)||(this.jIpt.prop("disabled")&&(this.jSubtractBtn.addClass("disable"),this.jPlusBtn.addClass("disable")),k(c,a),this.value=
a,b.remote?t.apply(this):b.onChange.apply(this)))},disable:function(){this.jIpt.attr("disabled","disabled");this.jSubtractBtn.addClass("disable");this.jPlusBtn.addClass("disable")},enable:function(){this.jIpt.removeAttr("disabled");this.jSubtractBtn.removeClass("disable");this.jPlusBtn.removeClass("disable");this.check()},setPostStatus:function(a){a?this.jLoading.addClass("loading"):this.jLoading.removeClass("loading");this.isPosting=a},getPostStatus:function(){return this.isPosting},destroy:function(){var a=
"";this.jSubtractBtn.off();this.jPlusBtn.off();this.jIpt.off();this.wrapper.remove();for(a in this)delete this[a];this.__proto__=null}};"function"===typeof define&&define.amd?define([],function(){return g}):"undefined"!==typeof module&&module.exports?module.exports=g:window.NumberEditor=g})(window.jQuery||window.Zepto);